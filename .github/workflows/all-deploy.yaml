name: single-deploy

on:
  workflow_dispatch:

run-name: deploy all

jobs:
  env-config-deploy:
    permissions:
      id-token: write
      contents: read
    uses: ./.github/workflows/reusable-deploy.yaml
    with:
      application-name: env-config
    secrets: inherit

  all-deploy:
    needs: env-config-deploy
    strategy:
      matrix:
        application-name:
          - akari-front
          - nina-api
          - zeus-api
    permissions:
      id-token: write
      contents: read
    uses: ./.github/workflows/reusable-deploy.yaml
    with:
      application-name: ${{ matrix.application-name }}
    secrets: inherit
